<div class="row page-title"><i class='bi-receipt-cutoff'></i>Retención</div>
<div class="component-content">
    <div class=" my-2">

        <button (click)="modal.show();nuevo()" type="button" class="btn btn-primary">
            Nueva Retención <i class="bi-plus"></i>
        </button>
    </div>
    <!-- <div class="table-responsive p-1">
      <table #tabla datatable [dtOptions]="dtOptions" [dtTrigger]="dtTrigger" class="table-custom">
        <thead>
          <tr>
            <th class="text-center w-gear"><i class="bi-files"></i></th>
            <th class="text-center">FECHA EMISIÓN</th>
            <th>DOCUMENTO</th>
            <th>CLIENTE</th>
            <th>CLAVE ACCESO</th>
            <th class="text-center">ESTADO</th>
            <th>FECHA AUTORIZACIÓN</th>
            <th class="text-end">TELÉFONO</th>
            <th>EMAIL</th>
  
          </tr>
        </thead>
        @if(lista.length>0){
  
        <tbody>
          @for(item of lista;track item.claveAcceso){
          <tr>
            <td class="text-center">
              @if(item.estadoSri=='AUTORIZADO'){
              <button (click)="xml(item.claveAcceso)" title="Descargar XML" type="button"
                class="btn text-primary btn-sm btn-file-td" style="padding:2px 0 2px 6px"><i class="bi-filetype-xml"
                  style="font-size:12px"></i></button>
              <button (click)="pdf(item.claveAcceso)" title="Descargar PDF" type="button"
                class="btn text-danger btn-sm btn-file-td" style="padding:2px 0 2px 6px"><i class="bi-filetype-pdf"
                  style="font-size:12px"></i></button>
              }
              @else if(item.estadoSri=="EN PROCESAMIENTO"){
              <span class="fs-xs">EN PROCESAMIENTO</span>
              }
              @else if(item.estadoSri=="NO AUTORIZADO"){
              <button (click)="xml(item.claveAcceso)" title="Descargar XML" type="button"
                class="btn text-primary btn-sm btn-file-td" style="padding:2px 0 2px 6px"><i class="bi-filetype-xml"
                  style="font-size:12px"></i></button>
              <button (click)="pdf(item.claveAcceso)" title="Descargar PDF" type="button"
                class="btn text-danger btn-sm btn-file-td" style="padding:2px 0 2px 6px"><i class="bi-filetype-pdf"
                  style="font-size:12px"></i></button>
              }@else if(item.estadoSri=="RECIBIDA"){
              <span class="fs-xs">ESPERANDO AUTORIZACIÓN</span>
              }
              @else{
              <button (click)="reenviar(item.claveAcceso)" title="Reenviar a SRI" type="button"
                class="btn text-info btn-sm btn-file-td" style="padding:2px 0 2px 6px"><i class="bi-arrow-clockwise"
                  style="font-size:12px"></i></button>
              }
            </td>
            <td width="5%" class="text-center">{{item.fechaEmision.substring(0,10).split('-').reverse().join('-')}}</td>
            <td>
              {{item.establecimiento?.toString().padStart(3,'0')}}-{{item.puntoEmision?.toString().padStart(3,'0')}}-{{item.secuencial?.toString().padStart(9,'0')}}
            </td>
            <td width="25%">{{item.cliente}}</td>
            <td width="30%">{{item.claveAcceso}}</td>
            <td width="5%"><span class="badge fw-500" [style]="getColor(item.idTipoEstadoSri)">{{item.estadoSri}}</span>
            </td>
            <td width="10%" class="text-center">
              @if(item.estadoSri=='AUTORIZADO'){
              {{item.fechaAutorizacion.substring(0,10).split('-').reverse().join('-')}}
              <b>{{item.fechaAutorizacion.substring(11,16)}}{{(item.fechaAutorizacion.substring(11,13))>=12?"PM":"AM"}}</b>
              }@else {
              <span class="fs-xs">ESPERANDO AUTORIZACIÓN</span>
              }
            </td>
            <td class="text-end">{{item.telefonoCliente}}</td>
            <td width="10%" class="text-email">{{item.emailCliente}}</td>
          </tr>
          }
        </tbody>
        }@else {
        <tbody>
          <tr>
            <td colspan="10" class="no-data-available text-center" [innerHTML]="mensajeDataTable"></td>
          </tr>
        </tbody>
        }
      </table>
    </div> -->
</div>

<div class="modal fade glass" #modalRetenciones tabindex="-1" role="dialog" aria-labelledby="modalDatosLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-fullscreen" role="document">
        <div class="modal-content bg-modal-factura">
            <div class="modal-header pt-1 pb-1 text-end">
                <label class="modal-title" id="modalDatosLabel">
                    <h6>{{tipoDocumento}} N°
                        <b class="text-danger">{{establecimiento}}-{{puntoEmision}}-{{secuencial.toString().padStart(9,'0')}}
                        </b>
                    </h6>
                </label>
                <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close" (click)="modal.hide()">
                </button>
            </div>
            <div class="modal-body bg-white">


                <div class="row gx-2 mt-1">
                    <div class="col-sm-7">
                        <div class="card card-custom px-2">
                            <h5 class="card-title">Comprobante
                            </h5>
                            <div class="card-body pt-0">
                                <form class="row" #frmCliente>

                                    <div class="col-sm-3">
                                        <label class="form-label">Doc. Sutento</label>
                                        <input type="text" class="form-control form-control-sm" id="docSustento"
                                            name="razonSocial" maxlength="500" />
                                        <div class="invalid-feedback">
                                            *Campo Requerido
                                        </div>
                                    </div>

                                    <div class="col-sm-3">
                                        <label class="form-label">N.- Comprobante</label>
                                        <input type="text" class="form-control form-control-sm" id="identificacion"
                                            name="identificacion" maxlength="30" data-clean="false" />
                                    </div>
                           

                                    <div class="col-sm-6">
                                        <label class="form-label">Clave Acceso</label>
                                        <input type="text" class="form-control form-control-sm" id="razonSocial"
                                            name="razonSocial" maxlength="500" />
                                        <div class="invalid-feedback">
                                            *Campo Requerido
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <div class="col-sm-5">
                        <div class="card card-custom">
                            <h5 class="card-title">EMISOR</h5>
                            <div class="card-body pt-0">
                                <form #frmEmisor class="row">
                                    <div class="col-sm-4">
                                        <label class="form-label">Fecha Emisión</label>
                                        <input type="date" class="form-control form-control-sm" id="fechaEmision"
                                            name="fechaEmision" />
                                        <div class="invalid-feedback">
                                            *Campo Requerido
                                        </div>
                                    </div>
                                    <div class="col-sm-4">
                                        <label class="form-label">Establecimiento</label>
                                        <select class="form-select form-select-sm text-end" id="idEstablecimiento"
                                            name="idEstablecimiento" (change)="handleNumeroFactura()">
                                            @for(item of listaEstablecimientos;track item.idEstablecimiento){
                                            <option value="{{item.idEstablecimiento}}">
                                                {{item.nombre.toString().padStart(3,'0')}}</option>
                                            }
                                        </select>
                                    </div>
                                    <div class="col-sm-4">
                                        <label class="form-label">Punto Emisión</label>
                                        <select class="form-select form-select-sm text-end" id="idPuntoEmision"
                                            name="idPuntoEmision" (change)="handleNumeroFactura()">
                                            @for(item of listaPuntosEmisiones;track item.idPuntoEmision){
                                            <option value="{{item.idPuntoEmision}}">
                                                {{item.nombre.toString().padStart(3,'0')}}</option>
                                            }
                                        </select>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                </div>

            </div>
            <div class="modal-footer bg-light py-2">
                <button type="button" class="btn btn-success btn-sm">Firmar y enviar</button>
                <button type="button" class="btn btn-secondary btn-sm" (click)="modal.hide()">Cancelar</button>
            </div>
        </div>
    </div>
</div>